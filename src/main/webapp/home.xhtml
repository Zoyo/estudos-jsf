<f:view id="ajaxEcho" xmlns="http://www.w3.org/1999/xhtml" 
	xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core" 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui">
    <h:head >
		<script src="http://maps.google.com/maps/api/js?sensor=true" 
				type="text/javascript">
		</script> 
	</h:head>
	<h:body>
		<h2>Testes gerais de JSF</h2>

		<h:form id="form1">
			<p:growl autoUpdate="true" life="3000" />
			
			<p:panelGrid>
				<p:row>
					<p:column>
						<p:outputLabel for="inputLatitude">Latitude: </p:outputLabel>
					</p:column>
					<p:column>
						<p:inputText id="inputLatitude" required="true" value="#{myBean.latitude}" />
					</p:column>
				</p:row>
	    		
	    		<p:row>
					<p:column>
		            	<p:outputLabel for="inputLongitude">Longitude: </p:outputLabel>
					</p:column>
					<p:column>
		            	<p:inputText id="inputLongitude" required="true" value="#{myBean.longitude}" />
					</p:column>
	    		</p:row>        
	            
	            <p:row>
					<p:column>
		            	<p:commandButton action="#{myBean.adicionaMarcacao()}" value="Marcar" update="@form"/>
					</p:column>
					<p:column>
		            	<p:commandButton action="#{myBean.enderecoDeCasa()}" value="Minha Casa" update="@form"/>
					</p:column>
	            </p:row>
	            
	            <p:row>
					<p:column colspan="2">
			            <p:gmap center="-22.820492, -47.265501" 
			                    zoom="15" 
			                    type="roadmap" 
			                    style="width:600px;height:400px"
			                    onPointClick="handlePointClick(event);"
			                    id="gmapa"
			                    model="#{myBean.simpleModel}"
			                    widgetVar="mapa">
						</p:gmap>
					</p:column>	            
	            </p:row>
			</p:panelGrid>
			
			<h:inputHidden id="inputHiddenLatitude" value="#{myBean.latitude}" />
			<h:inputHidden id="inputHiddenLongitude" value="#{myBean.longitude}" />
		</h:form>
		
		<script type="text/javascript">
			var currentMarker = null;

			
			function handlePointClick(event) {
				console.log("Latitude:" + event.latLng.lat() + "\nLongitude: " + event.latLng.lng());
// 				if(currentMarker === null) {
					document.getElementById("form1:inputHiddenLatitude").value = event.latLng.lat();
					document.getElementById("form1:inputHiddenLongitude").value = event.latLng.lng();

					currentMarker = new google.maps.Marker({
						position : new google.maps.LatLng(event.latLng.lat(), event.latLng.lng())
					});

					mapa.addOverlay(currentMarker);
// 				}	
			}
		</script>
	</h:body>
</f:view>